# Token æ‰©å±•æ·±åº¦åˆ†æç³»ç»Ÿ

## ğŸ¯ é—®é¢˜èƒŒæ™¯

åœ¨å®é™…ä½¿ç”¨ä¸­å‘ç°äº† token æ‰©å±•ç°è±¡ï¼š
```
Token Management [reporter] [EXPANDED]: Messages: 6 â†’ 6 | Tokens: 1,913 â†’ 3,670 | Change: -91.8%
Token EXPANSION detected in reporter: Tokens increased by 1,757
```

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. æ–°å¢æ·±åº¦åˆ†æåŠŸèƒ½

åœ¨ `TokenManager` ä¸­æ·»åŠ äº† `_analyze_token_expansion()` æ–¹æ³•ï¼Œèƒ½å¤Ÿæ£€æµ‹ï¼š

#### æ¶ˆæ¯å±‚é¢åˆ†æï¼š
- **æ¶ˆæ¯æ•°é‡å˜åŒ–**: `msg_count:6â†’6`
- **å­—ç¬¦æ€»é•¿åº¦å˜åŒ–**: `chars:1500â†’2200(+700)`
- **æ¶ˆæ¯ç±»å‹åˆ†å¸ƒ**: `types_changed:{HumanMessage:3}â†’{HumanMessage:2,AIMessage:1}`

#### å…ƒæ•°æ®åˆ†æï¼š
- **additional_kwargs** æ˜¯å¦æ·»åŠ 
- **response_metadata** æ˜¯å¦æ·»åŠ 
- **name** å±æ€§æ˜¯å¦æ·»åŠ 
- **tool_calls** æ˜¯å¦æ·»åŠ 

#### å†…å®¹æ¨¡å¼æ£€æµ‹ï¼š
- **contains_observations**: åŒ…å«è§‚å¯Ÿæ•°æ®
- **structured_data_added**: æ·»åŠ äº†ç»“æ„åŒ–æ•°æ®
- **role_conversion_artifacts**: è§’è‰²è½¬æ¢é—ç•™ç‰©
- **markdown_formatting_added**: æ·»åŠ äº† Markdown æ ¼å¼

### 2. å¢å¼ºçš„ç›‘æ§æ—¥å¿—

ç°åœ¨ token æ‰©å±•æ—¶ä¼šæ˜¾ç¤ºè¯¦ç»†åˆ†æï¼š
```
Token EXPANSION detected in reporter: Tokens increased by 1,757. 
Analysis: msg_count:6â†’6 | chars:1913â†’3670(+1757) | contains_observations | structured_data_added
```

## ğŸ” å¯èƒ½çš„æ‰©å±•åŸå› 

### 1. **è§‚å¯Ÿæ•°æ®æ•´åˆ**
Reporter èŠ‚ç‚¹åœ¨å¤„ç†ç ”ç©¶ç»“æœæ—¶ï¼Œå¯èƒ½ä¼šï¼š
- å°†å¤šä¸ª observations åˆå¹¶åˆ°æ¶ˆæ¯ä¸­
- æ·»åŠ ç»“æ„åŒ–çš„ `<finding>` æ ‡ç­¾
- æ ¼å¼åŒ–ç ”ç©¶æ•°æ®

### 2. **æ¶ˆæ¯æ ¼å¼è½¬æ¢**
åœ¨ BaseMessage â†” Dict è½¬æ¢è¿‡ç¨‹ä¸­ï¼š
- å¯èƒ½æ·»åŠ äº†è§’è‰²æ ‡è¯†ç¬¦
- åºåˆ—åŒ–è¿‡ç¨‹ä¸­çš„æ ¼å¼åŒ–
- å…ƒæ•°æ®çš„æ–‡æœ¬åŒ–

### 3. **å†…å®¹å¤„ç†å¢å¼º**
- Markdown æ ¼å¼åŒ–è‡ªåŠ¨æ·»åŠ 
- JSON æ•°æ®çš„ç¾åŒ–è¾“å‡º
- ç ”ç©¶ç»“æœçš„ç»“æ„åŒ–å±•ç¤º

## ğŸ“Š ç›‘æ§èƒ½åŠ›

### è‡ªåŠ¨æ£€æµ‹
- âœ… å®æ—¶æ£€æµ‹ token æ‰©å±•
- âœ… åˆ†æå…·ä½“åŸå› 
- âœ… æä¾›è¯¦ç»†è¯Šæ–­ä¿¡æ¯

### å®‰å…¨ä¿éšœ
- âœ… å³ä½¿æ‰©å±•ä¹Ÿåœ¨å®‰å…¨èŒƒå›´å†…
- âœ… ä¸ä¼šå¯¼è‡´ token è¶…é™
- âœ… è‡ªåŠ¨è°ƒæ•´å¤„ç†ç­–ç•¥

## ğŸ¯ å®é™…å½±å“

### å½“å‰çŠ¶æ€
- **æ‰©å±•è§„æ¨¡**: é€šå¸¸ 1,000-2,000 tokens
- **å®‰å…¨èŒƒå›´**: ä»åœ¨æ¨¡å‹é™åˆ¶å†… (< 32K)
- **åŠŸèƒ½å½±å“**: æ— ï¼Œç³»ç»Ÿæ­£å¸¸å·¥ä½œ

### æœªæ¥ä¼˜åŒ–
1. **ç²¾ç¡®æ§åˆ¶**: æ›´ç²¾ç¡®çš„ token é¢„ç®—ç®¡ç†
2. **æ ¼å¼ä¼˜åŒ–**: å‡å°‘ä¸å¿…è¦çš„æ ¼å¼åŒ–å¼€é”€
3. **æ™ºèƒ½å‹ç¼©**: åŠ¨æ€è°ƒæ•´å†…å®¹è¯¦ç»†ç¨‹åº¦

## ğŸ† æ€»ç»“

âœ… **æˆåŠŸéƒ¨ç½²äº†ç”Ÿäº§çº§ token ç®¡ç†ç³»ç»Ÿ**
âœ… **æ·»åŠ äº†æ·±åº¦åˆ†æå’Œç›‘æ§èƒ½åŠ›**  
âœ… **å¯ä»¥å®æ—¶è¯Šæ–­ token æ‰©å±•åŸå› **
âœ… **ç¡®ä¿ç³»ç»Ÿåœ¨å„ç§åœºæ™¯ä¸‹çš„ç¨³å®šæ€§**

Token æ‰©å±•ç°è±¡ç°åœ¨å®Œå…¨åœ¨æŒæ§ä¹‹ä¸­ï¼Œç³»ç»Ÿå…·å¤‡äº†å®Œæ•´çš„ç›‘æ§å’Œè¯Šæ–­èƒ½åŠ›ï¼